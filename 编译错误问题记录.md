# Vibe Kanban ç¼–è¯‘é”™è¯¯é—®é¢˜è®°å½•

**ç›®çš„**: è®°å½•æ‰€æœ‰é‡åˆ°è¿‡çš„ç¼–è¯‘é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆï¼Œé¿å…é‡å¤çŠ¯é”™  
**æ›´æ–°æ—¥æœŸ**: 2026-01-25

---

## ğŸš¨ å…³é”®é—®é¢˜æ¸…å•

### 1. âœ… å¤§æ–‡ä»¶æäº¤é—®é¢˜

**é”™è¯¯è¡¨ç°**:
```
GitHub è­¦å‘Š: æäº¤äº† 75MB äºŒè¿›åˆ¶æ–‡ä»¶
```

**åŸå› **:
- æäº¤äº† `vibe-kanban.exe` (64MB)
- æäº¤äº† `rustup-init.exe` (11MB)

**è§£å†³æ–¹æ¡ˆ**:
```bash
git rm --cached vibe-kanban.exe rustup-init.exe
echo "*.exe" >> .gitignore
git commit -m "chore: remove large binary files"
```

**é¢„é˜²æªæ–½**:
- âœ… æ°¸ä¸æäº¤äºŒè¿›åˆ¶æ–‡ä»¶åˆ° Git
- âœ… æ£€æŸ¥ `.gitignore` æ˜¯å¦æ­£ç¡®é…ç½®
- âœ… æäº¤å‰è¿è¡Œ `git status` æ£€æŸ¥å¤§æ–‡ä»¶

---

### 2. âœ… SQLx ç¦»çº¿æ¨¡å¼ç¼ºå¤±

**é”™è¯¯è¡¨ç°**:
```
error: set `DATABASE_URL` to use query macros online
   --> crates/db/src/models/task_session.rs:37:9
```

**åŸå› **:
- GitHub Actions workflow ç¼ºå°‘ `SQLX_OFFLINE=true`
- SQLx é»˜è®¤å°è¯•è¿æ¥æ•°æ®åº“éªŒè¯æŸ¥è¯¢

**è§£å†³æ–¹æ¡ˆ**:
åœ¨ `.github/workflows/pre-release.yml` çš„æ‰€æœ‰åç«¯æ„å»ºæ­¥éª¤ä¸­æ·»åŠ ï¼š
```yaml
env:
  SQLX_OFFLINE: true  # å…³é”®é…ç½®
```

**æ¶‰åŠæ–‡ä»¶**:
- `.github/workflows/pre-release.yml` (Linux æ„å»º)
- `.github/workflows/pre-release.yml` (macOS æ„å»º)
- `.github/workflows/pre-release.yml` (Windows æ„å»º)

**é¢„é˜²æªæ–½**:
- âœ… ç‹¬æœ‰åŠŸèƒ½ä½¿ç”¨è¿è¡Œæ—¶æŸ¥è¯¢ï¼Œä¸ä½¿ç”¨æŸ¥è¯¢å®
- âœ… æ£€æŸ¥ workflow æ˜¯å¦åŒ…å« `SQLX_OFFLINE=true`
- âœ… ä¸è¦ä½¿ç”¨ `sqlx::query_as!` ç­‰ç¼–è¯‘æ—¶å®

---

### 3. âœ… SQLx æŸ¥è¯¢ç¼“å­˜ç¼ºå¤±

**é”™è¯¯è¡¨ç°**:
```
error: `SQLX_OFFLINE=true` but there is no cached data for this query
   --> crates/db/src/models/task_session.rs:37:9
```

**åŸå› **:
- ç‹¬æœ‰åŠŸèƒ½ä½¿ç”¨ `sqlx::query_as!` å®
- æ²¡æœ‰å¯¹åº”çš„ `.sqlx/query-*.json` ç¼“å­˜æ–‡ä»¶
- ä¸Šæ¸¸ä¸ä¼šæœ‰æˆ‘ä»¬ç‹¬æœ‰åŠŸèƒ½çš„ç¼“å­˜

**è§£å†³æ–¹æ¡ˆ**:
å°†æ‰€æœ‰ SQLx æŸ¥è¯¢å®æ”¹ä¸ºè¿è¡Œæ—¶æŸ¥è¯¢ï¼š

**é”™è¯¯å†™æ³•**:
```rust
sqlx::query_as!(
    TaskSession,
    r#"SELECT id AS "id!: Uuid",
              task_id AS "task_id!: Uuid"
       FROM task_sessions
       WHERE id = $1"#,
    id
)
```

**æ­£ç¡®å†™æ³•**:
```rust
sqlx::query_as::<_, TaskSession>(
    r#"SELECT id,
              task_id
       FROM task_sessions
       WHERE id = ?"#
)
.bind(id)
```

**ä¿®æ”¹çš„æ–‡ä»¶**:
1. `crates/db/src/models/task_session.rs` - 6 ä¸ªæŸ¥è¯¢
2. `crates/db/src/models/project.rs` - `find_by_name` æŸ¥è¯¢
3. `crates/db/src/models/repo.rs` - `update_path` æŸ¥è¯¢
4. `crates/db/src/models/tag.rs` - `find_by_tag_name` æŸ¥è¯¢

**é¢„é˜²æªæ–½**:
- âœ… ç‹¬æœ‰åŠŸèƒ½æ°¸è¿œä½¿ç”¨è¿è¡Œæ—¶æŸ¥è¯¢
- âœ… é¿å…ä½¿ç”¨ä»»ä½• `sqlx::*!` å®
- âœ… ä½¿ç”¨ `sqlx::query_as::<_, Type>` å½¢å¼

---

### 4. âœ… ç¼ºå°‘ walkdir ä¾èµ–

**é”™è¯¯è¡¨ç°**:
```
error[E0433]: failed to resolve: use of unresolved module or unlinked crate `walkdir`
   --> crates/services/src/services/session_exporter.rs:174:23
```

**åŸå› **:
- ä¸Šæ¸¸ä½¿ç”¨äº† `walkdir` crate
- ä½†åœ¨ `Cargo.toml` ä¸­å¿˜è®°å£°æ˜ä¾èµ–

**è§£å†³æ–¹æ¡ˆ**:
åœ¨ `crates/services/Cargo.toml` ä¸­æ·»åŠ ï¼š
```toml
walkdir = "2.5"
```

**ä½ç½®**: æ”¾åœ¨ `sqlx` å’Œ `chrono` ä¹‹é—´

**é¢„é˜²æªæ–½**:
- âš ï¸ è¿™æ˜¯ä¸Šæ¸¸çš„é—®é¢˜ï¼Œæ— æ³•é¢„é˜²
- âœ… è®°ä½è¿™ä¸ªé”™è¯¯ï¼Œä¸‹æ¬¡æ·»åŠ ç±»ä¼¼åŠŸèƒ½æ—¶æ£€æŸ¥ä¾èµ–

---

### 5. âœ… session_exporter ç±»å‹é”™è¯¯

**é”™è¯¯è¡¨ç°**:
```
error[E0308]: mismatched types
   --> crates/services/src/services/session_exporter.rs:129:16
    |
129 |         if let Some(Some(branch)) = &workspace.branch {
    |                ^^^^^^^^^^^^^^^^^^   ----------------- this expression has type `&std::string::String`
    |                |
    |                expected `String`, found `Option<_>`

error[E0308]: mismatched types
   --> crates/services/src/services/session_exporter.rs:192:81
    |
192 |             if let Some(task_id) = self.extract_task_id_from_path(&session_dir, &path) {
    |                                         -------------------------               ^^^^ expected `&PathBuf`, found `&&Path`
```

**åŸå› **:
1. `workspace.branch` æ˜¯ `String` ç±»å‹ï¼Œä¸æ˜¯ `Option<String>` æˆ– `Option<Option<String>>`
2. WalkDir è¿”å›çš„ `path` æ˜¯ `&Path`ï¼Œä½†å‡½æ•°æœŸæœ› `&PathBuf`

**è§£å†³æ–¹æ¡ˆ**:
1. ç›´æ¥ä½¿ç”¨ `workspace.branch`ï¼Œä¸éœ€è¦ Option æ¨¡å¼åŒ¹é…
2. ä½¿ç”¨ `path.to_path_buf()` å°† `&Path` è½¬æ¢ä¸º `PathBuf`

**é”™è¯¯å†™æ³•**:
```rust
// é”™è¯¯ï¼šbranch æ˜¯ Stringï¼Œä¸èƒ½ç”¨ Option æ¨¡å¼åŒ¹é…
if let Some(Some(branch)) = &workspace.branch {
    md.push_str(&format!("- **Branch**: {}\n", branch));
}
// é”™è¯¯ï¼š&path æ˜¯ &Pathï¼Œä¸æ˜¯ &PathBuf
if let Some(task_id) = self.extract_task_id_from_path(&session_dir, &path) {
```

**æ­£ç¡®å†™æ³•**:
```rust
// branch æ˜¯ Stringï¼Œç›´æ¥ä½¿ç”¨
md.push_str(&format!("- **Branch**: {}\n", workspace.branch));

// éœ€è¦è½¬æ¢ &Path åˆ° PathBuf
let path_buf = path.to_path_buf();
if let Some(task_id) = self.extract_task_id_from_path(&session_dir, &path_buf) {
    // ...
}
```

**é¢„é˜²æªæ–½**:
- âš ï¸ éœ€è¦æŸ¥çœ‹å®é™…çš„ç»“æ„ä½“å®šä¹‰ï¼Œä¸è¦å‡è®¾å­—æ®µç±»å‹
- âœ… ä½¿ç”¨ `cargo check` æœ¬åœ°éªŒè¯ç±»å‹
- âœ… æ³¨æ„åŒºåˆ† `&Path`ã€`PathBuf`ã€`&PathBuf`
- âœ… WalkDir çš„ `entry.path()` è¿”å› `&Path`ï¼Œéœ€è¦ç”¨ `.to_path_buf()` è½¬æ¢

---

### 6. âœ… server crate çš„ä¾èµ–å’ŒæŸ¥è¯¢å®é—®é¢˜

**é”™è¯¯è¡¨ç°**:
```
error: `SQLX_OFFLINE=true` but there is no cached data for this query
   --> crates/server/src/routes/data_management.rs:450:21
    |
450 | /                     sqlx::query!(
451 | |                         "INSERT INTO projects (id, name, default_agent_working_dir, remote_project_id) VALUES (?, ?, ?, ?)"
452 | |                     )
    | |_____________________^

error: `SQLX_OFFLINE=true` but there is no cached data for this query
   --> crates/server/src/routes/data_management.rs:488:25
    |
488 | /                         sqlx::query!(
489 | |                             "INSERT INTO tags (id, tag_name, content) VALUES (?, ?, ?)"
490 | |                         )
    | |_________________________^

error[E0433]: failed to resolve: use of unresolved module or unlinked crate `zip`
   --> crates/server/src/routes/data_management.rs:521:9
    |
521 |     use zip::{ZipWriter, write::FileOptions};
    |         ^^^ use of unresolved module or unlinked crate `zip`

error[E0433]: failed to resolve: use of unresolved module or unlinked crate `directories`
   --> crates/server/src/routes/config.rs:549:9
    |
549 |         directories::ProjectDirs::from("ai", "bloop", "vibe-kanban")
    |         ^^^^^^^^^^^ use of unresolved module or unlinked crate `directories`
```

**åŸå› **:
1. `data_management.rs` ä½¿ç”¨äº† `sqlx::query!` å®ï¼Œä½†æ²¡æœ‰å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶
2. ä¸Šæ¸¸ä½¿ç”¨äº† `zip` å’Œ `directories` crateï¼Œä½†å¿˜è®°åœ¨ `Cargo.toml` ä¸­å£°æ˜

**è§£å†³æ–¹æ¡ˆ**:
1. å°† `sqlx::query!` æ”¹ä¸º `sqlx::query` è¿è¡Œæ—¶æŸ¥è¯¢
2. åœ¨ `crates/server/Cargo.toml` ä¸­æ·»åŠ ç¼ºå¤±çš„ä¾èµ–

**ä¿®æ”¹çš„æ–‡ä»¶**:
1. `crates/server/src/routes/data_management.rs` - 2ä¸ªæŸ¥è¯¢å®
2. `crates/server/Cargo.toml` - æ·»åŠ  `zip = "2.2"` å’Œ `directories = "5.0"`

**é”™è¯¯å†™æ³•**:
```rust
sqlx::query!(
    "INSERT INTO projects (id, name, default_agent_working_dir, remote_project_id) VALUES (?, ?, ?, ?)"
)
```

**æ­£ç¡®å†™æ³•**:
```rust
sqlx::query(
    "INSERT INTO projects (id, name, default_agent_working_dir, remote_project_id) VALUES (?, ?, ?, ?)"
)
```

**é¢„é˜²æªæ–½**:
- âš ï¸ è¿™æ˜¯ä¸Šæ¸¸çš„é—®é¢˜ï¼Œæ— æ³•é¢„é˜²
- âœ… è®°ä½è¿™ä¸ªé”™è¯¯ï¼Œä¸‹æ¬¡æ·»åŠ ç±»ä¼¼åŠŸèƒ½æ—¶æ£€æŸ¥ä¾èµ–
- âœ… ç‹¬æœ‰åŠŸèƒ½æ°¸è¿œä½¿ç”¨è¿è¡Œæ—¶æŸ¥è¯¢ï¼Œé¿å…ä½¿ç”¨ `sqlx::query!` å®

---

## ğŸ“‹ ç¼–è¯‘å‰æ£€æŸ¥æ¸…å•

### ä»£ç ä¿®æ”¹åå¿…é¡»æ£€æŸ¥

- [ ] æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº† `sqlx::*!` å®
- [ ] å¦‚æœä½¿ç”¨äº†å®ï¼Œæ”¹ä¸ºè¿è¡Œæ—¶æŸ¥è¯¢
- [ ] æ£€æŸ¥æ˜¯å¦å¼•å…¥äº†æ–°çš„å¤–éƒ¨ crate
- [ ] æ£€æŸ¥ `Cargo.toml` æ˜¯å¦åŒ…å«æ‰€æœ‰ä¾èµ–
- [ ] æ£€æŸ¥ `.gitignore` æ˜¯å¦æ­£ç¡®
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰å¤§æ–‡ä»¶è¢«è¿½è¸ª

### æäº¤å‰æ£€æŸ¥

- [ ] è¿è¡Œ `npm run lint` (å‰ç«¯)
- [ ] è¿è¡Œ `npm run check` (å‰ç«¯)
- [ ] è¿è¡Œ `cargo check` (åç«¯)
- [ ] æ£€æŸ¥ `git status` ä¸­æ˜¯å¦æœ‰å¤§æ–‡ä»¶

### æ¨é€å‰æ£€æŸ¥

- [ ] ç¡®è®¤æ‰€æœ‰ä¾èµ–å·²å£°æ˜
- [ ] ç¡®è®¤ workflow é…ç½®æ­£ç¡®
- [ ] ç¡®è®¤ SQLX_OFFLINE=true å·²è®¾ç½®

---

## ğŸ”§ å¿«é€Ÿä¿®å¤å‘½ä»¤

### å¦‚æœé‡åˆ° SQLx é”™è¯¯

```bash
# 1. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æŸ¥è¯¢å®
grep -r "sqlx::query_as!\|sqlx::query!\|sqlx::query_scalar!" crates/db/src/

# 2. ä¿®æ”¹ä¸ºè¿è¡Œæ—¶æŸ¥è¯¢
# ä» sqlx::query_as!(Type, "SELECT ... WHERE id = $1", id)
# æ”¹ä¸º sqlx::query_as::<_, Type>("SELECT ... WHERE id = ?").bind(id)
```

### å¦‚æœé‡åˆ°ç¼ºå°‘ä¾èµ–é”™è¯¯

```bash
# 1. æŸ¥çœ‹ä½¿ç”¨çš„ crate
grep -r "use " | grep "walkdir\|å…¶ä»–crate"

# 2. æ·»åŠ åˆ°å¯¹åº”çš„ Cargo.toml
# æ·»åŠ  crate_name = "version"
```

### å¦‚æœé‡åˆ°å¤§æ–‡ä»¶è­¦å‘Š

```bash
# 1. æŸ¥æ‰¾å¤§æ–‡ä»¶
find . -type f -size +50M -not -path "./.git/*"

# 2. ç§»é™¤è¿½è¸ª
git rm --cached <file>

# 3. æ›´æ–° .gitignore
echo "*.exe" >> .gitignore
```

---

## ğŸ“š ç»éªŒæ•™è®­

### æ ¸å¿ƒåŸåˆ™

1. **CI/CD ç¯å¢ƒå¿…é¡»ç¦»çº¿ç¼–è¯‘**
   - ä½¿ç”¨ `SQLX_OFFLINE=true`
   - é¿å…ä¾èµ–æ•°æ®åº“è¿æ¥

2. **ç‹¬æœ‰åŠŸèƒ½é¿å…ç¼–è¯‘æ—¶æ£€æŸ¥**
   - ä¸ä½¿ç”¨ `sqlx::*!` å®
   - ä½¿ç”¨è¿è¡Œæ—¶æŸ¥è¯¢ API

3. **æ°¸è¿œä¸æäº¤äºŒè¿›åˆ¶æ–‡ä»¶**
   - é…ç½®æ­£ç¡®çš„ `.gitignore`
   - æäº¤å‰æ£€æŸ¥æ–‡ä»¶å¤§å°

4. **ä¾èµ–å£°æ˜å¿…é¡»å®Œæ•´**
   - æ£€æŸ¥ `Cargo.toml`
   - åŒ…å«æ‰€æœ‰ä½¿ç”¨çš„ crate

### å¸¸è§é™·é˜±

| é™·é˜± | åæœ | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| ä½¿ç”¨æŸ¥è¯¢å® | CI ç¼–è¯‘å¤±è´¥ | æ”¹ç”¨è¿è¡Œæ—¶æŸ¥è¯¢ |
| æäº¤äºŒè¿›åˆ¶æ–‡ä»¶ | ä»“åº“è†¨èƒ€ | æ·»åŠ åˆ° .gitignore |
| å¿˜è®°å£°æ˜ä¾èµ– | ç¼–è¯‘å¤±è´¥ | æ£€æŸ¥å¹¶æ·»åŠ åˆ° Cargo.toml |
| ç¼ºå°‘ç¦»çº¿æ¨¡å¼é…ç½® | CI ç¼–è¯‘å¤±è´¥ | æ·»åŠ  SQLX_OFFLINE=true |

---

## ğŸ¯ æœ€ä½³å®è·µ

### æ·»åŠ æ–°åŠŸèƒ½æ—¶

1. **åç«¯æ–°å¢åŠŸèƒ½**
   ```rust
   // âŒ ä¸è¦è¿™æ ·
   sqlx::query_as!(MyType, "SELECT ... WHERE id = $1", id)
   
   // âœ… è¦è¿™æ ·
   sqlx::query_as::<_, MyType>("SELECT ... WHERE id = ?")
       .bind(id)
   ```

2. **æ·»åŠ æ–°ä¾èµ–**
   ```bash
   # ç«‹å³æ·»åŠ åˆ° Cargo.toml
   cargo add dependency-name
   ```

3. **æäº¤å‰æ£€æŸ¥**
   ```bash
   # æ£€æŸ¥å¤§æ–‡ä»¶
   git ls-files | while read f; do [ -f "$f" ] && [ $(stat -f %s "$f") -gt 52428800 ] && echo "$f"; done
   
   # æ£€æŸ¥æŸ¥è¯¢å®
   grep -r "sqlx::.*!" crates/
   ```

---

## ğŸ“ é—®é¢˜è¿½è¸ª

| æ—¥æœŸ | é—®é¢˜ | çŠ¶æ€ | æäº¤ |
|------|------|------|------|
| 2026-01-25 | å¤§æ–‡ä»¶è­¦å‘Š | âœ… å·²è§£å†³ | dea77bec |
| 2026-01-25 | SQLx ç¦»çº¿æ¨¡å¼ | âœ… å·²è§£å†³ | efc8ec24 |
| 2026-01-25 | task_session æŸ¥è¯¢å® | âœ… å·²è§£å†³ | 554bcbe0 |
| 2026-01-25 | project/repo/tag æŸ¥è¯¢å® | âœ… å·²è§£å†³ | 649f53ae |
| 2026-01-25 | ç¼ºå°‘ walkdir ä¾èµ– | âœ… å·²è§£å†³ | 8ab08b6c |
| 2026-01-25 | session_exporter ç±»å‹é”™è¯¯ | âœ… å·²è§£å†³ | 25a6f3e4 |
| 2026-01-25 | server ä¾èµ–å’ŒæŸ¥è¯¢å® | âœ… å·²è§£å†³ | fe0a4d59 |

---

## âš ï¸ é‡ç‚¹è®°å¿†

### æ°¸è¿œä¸è¦åšçš„äº‹

1. âŒ ä½¿ç”¨ `sqlx::query_as!`ã€`sqlx::query!`ã€`sqlx::query_scalar!` å®
2. âŒ æäº¤ `.exe`ã€`.dll`ã€`.so` ç­‰äºŒè¿›åˆ¶æ–‡ä»¶
3. âŒ å¿˜è®°åœ¨ `Cargo.toml` ä¸­å£°æ˜ä¾èµ–
4. âŒ åœ¨ CI/CD ä¸­ä¸è®¾ç½® `SQLX_OFFLINE=true`

### å¿…é¡»åšçš„äº‹

1. âœ… ä½¿ç”¨ `sqlx::query_as::<_, Type>()` è¿è¡Œæ—¶æŸ¥è¯¢
2. âœ… æ£€æŸ¥ `.gitignore` åŒ…å« `*.exe`ã€`*.dll` ç­‰
3. âœ… ä½¿ç”¨æ–°ä¾èµ–å‰æ·»åŠ åˆ° `Cargo.toml`
4. âœ… workflow ä¸­è®¾ç½® `SQLX_OFFLINE=true`

---

**è®°ä½è¿™äº›ï¼Œä»¥åä¸å†çŠ¯åŒæ ·çš„é”™è¯¯ï¼**

**æœ€åæ›´æ–°**: 2026-01-25  
**ç»´æŠ¤äºº**: AI Assistant
